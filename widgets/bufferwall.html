<script total>

	exports.id = 'bufferwall';
	exports.name = 'Bufferwall';
	exports.author = 'Total.js';
	exports.version = '1';
	exports.preview = 'data:image/jpeg;base64,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';
	exports.config = { layout: 'col-sm-3', token: '', count: 4, language: 'en', tag: '', detail: 'https://bufferwall.com/posts/{0}/', mobilecarousel: false };

	exports.install = function(db) {
		if (!db.vars.bufferwall)
			db.vars.bufferwall = 'YOUR_BUFFERWALL_TOKEN'
		if (!db.vars.swipecontent)
			db.vars.swipecontent = 'Swipe content';
	};

	exports.render = function(opt, next) {

		var config = opt.config;

		if (!config.token && !opt.vars.bufferwall)
			return next('');

		var query = {};

		query.limit = config.count || 8;
		config.tag && (query.tag = config.tag);
		query.languageid = config.language || 'en';

		if (!config.layout)
			config.layout = 'col-sm-3';

		var builder = RESTBuilder.GET('https://bufferwall.com/api/ex/posts/', query);
		builder.timeout(2000);
		builder.header('x-token', config.token || opt.vars.bufferwall);
		builder.exec(function(err, data) {

			if (err) {
				next('');
				return;
			}

			var builder = ['<div class="CLASS"><div class="row">'];

			if (config.mobilecarousel)
				builder.unshift('<ui-component name="mobilecarousel" config="selector:.' + config.layout + '" class="CLASS_container>');

			if (data && data.items) {
				for (var i = 0; i < data.items.length; i++) {
					var item = data.items[i];
					var name = item.name.encode();
					var url = (config.detail || 'https://blog.totaljs.com/posts/{0}/').format(item.id);
					builder.push('<div class="' + config.layout + '"><div class="CLASS_item"><a href="' + url + '" class="CLASS_image" target="_blank"><img src="' + item.picture + '" alt="' + name + '" class="img-responsive" border="0" /></a><a href="' + url + '" class="CLASS_link" target="_blank">' + (((NOW - item.dtpublished) / 1000 / 60 / 1440) < 3 ? '<span class="new">NEW</span>' : '') + '<strong>' + name + '</strong>.<span>' + item.summary.encode() + '</span></a><div class="CLASS_date">' + item.dtpublished.format('dd MMM. yyyy') + (item.readingtime ? (', ' + item.readingtime + ' min. read') : '') + '</div></div></div>');
				}
			}

			builder.push('</div>');

			if (config.mobilecarousel)
				builder.push('</ui-component><div class="CLASS_swipe wm"><i class="ti ti-long-arrow-left CMS_edit"></i><span class="CMS_edit">$swipecontent</span><i class="ti ti-long-arrow-right CMS_edit"></i></div>');

			builder.push('</div>');
			next(builder.join('').replace(/CLASS/g, 'w-bufferwall'), true, true);
		});
	};

</script>

<style>
	.CLASS_item { background-color: #F8F8F8; border: 1px solid rgba(0,0,0,0.15); margin-bottom: 25px; }
	.CLASS_link { height: 76px; display: block; overflow: hidden; line-height: 16px; padding: 10px 10px 0; color: gray; }
	.CLASS_link strong { color: #000; }
	.CLASS_link span { margin-left: 5px; }
	.CLASS_link .new { background-color: red; color: #FFF; font-size: 11px; padding: 2px 4px; border-radius: var(--radius); float: left; line-height: 11px; font-weight: bold; margin: 0 5px 0 0; }
	.CLASS_link:hover, .CLASS_link:hover * { text-decoration: none !important; }
	.CLASS_date { font-size: 12px; color: gray; padding: 3px 10px 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

	.CLASS_swipe { text-align: center; font-size: 11px; color: #A0A0A0; display: none; }
	.CLASS_swipe span { margin: 0 10px; }

	@media (min-width: 768px) and (max-width: 991px) {
		.CLASS_link { font-size: 12px; }
	}

	@media (max-width: 768px) {
		.CLASS_swipe { display: block; }
		.ui-mobilecarousel .CLASS_item { margin-bottom: 0 !important; }
	}
</style>

<settings>

	<div class="padding">
		<div class="grid-2">
			<div class="m">
				<ui-component name="input" path="?.token" config="camouflage:1;placeholder:Enter a token or it can be loaded from variables">Bufferwall token</ui-component>
			</div>
			<div class="m">
				<ui-component name="input" path="?.detail">URL for detail</ui-component>
			</div>
		</div>
		<div class="grid-2">
			<div class="m">
				<ui-component name="input" path="?.layout" config="dirsource:col-sm-3|4,col-sm-4|3;required:1">Layout</ui-component>
			</div>
			<div>
				<div class="grid-2">
					<div class="m">
						<ui-component name="input" path="?.count" config="type:number;format:">Count</ui-component>
					</div>
					<div class="m">
						<ui-component name="input" path="?.tag">Tag</ui-component>
					</div>
				</div>
			</div>
		</div>
	</div>

</settings>

<body>
	<div class="totaljs">Bufferwall posts</div>
</body>